<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
	<meta name="viewport" content="width=device-width,initial-scale=1" />
	<title>认证信息</title>
	<link rel="stylesheet" type="text/css" href="css/common.css"> 
<style type="text/css">
#id_card{
	float: left;
	left: 10%;
	top: 78px; 
	height: 26px; 
	line-height:30px;
	width: 80%;
	text-align: left;
	border: 1px solid rgba(187, 187, 187, 1);
	position: absolute;
}
#verify_text{
	left: 10%;
	top: 128px;
	width: 80%;
	height: 26px;
	text-align: left;
	border: 1px solid rgba(187, 187, 187, 1);
	float: left;
	position: absolute;
}
#xukezheng{
	left: 10%;
	top: 180px;
	height: 26px;
	width: 80%;
	text-align: left;
	border: 1px solid rgba(187, 187, 187, 1);
	float: left;
	position: absolute;
}
#renzheng{
	left: 24px;
	top: 410px;
	width: 87%;
	height: 41px;
	border-radius: 4px;
	background-color: rgba(75, 123, 249, 1);
	color: rgba(255, 255, 255, 1);
	font-size: 14px;
	text-align: center;
	font-family: Microsoft Yahei;
	border: 1px solid rgba(63, 81, 181, 1);
	float: left;
	position: absolute;
}
#rz_iphone{
	left: 10%;
	top: 229px;
	height: 26px;
	width: 80%;
	text-align: left;
	border: 1px solid rgba(187, 187, 187, 1);
	float: left;
	position: absolute;
}
#tradelicenseimg{
	left: 16px;
	top: 270px;
	width: 110px
	height: 23px;
	line-height: 20px;
	color: rgba(16, 16, 16, 1);
	font-size: 14px;
	text-align: center;
	border: 1px solid rgba(255, 255, 255, 1);
	font-family: Arial;
	float: left;
	position: absolute;
}
#tp_shangchuan{
	left: 24%;
	top: 270px;
	width: 200px;
	height: 120px;
	opacity: 0.67;
	border-radius: 4px;
	background-color: rgba(187, 187, 187, 1);
	color: rgba(255, 255, 255, 1);
	font-size: 14px;
	text-align: center;
	position: absolute;
    opacity:0;
    filter:alpha(opacity=0);
    position: absolute;
	font-family: Microsoft Yahei;
	border: 1px solid rgba(187, 187, 187, 1);
	position: absolute;
}
#trade_license_img{
	float: left;
	left: 125px;
	top: 270px;
	height: 26px;
	text-align: left;
	border: 1px solid rgba(255, 255, 255, 1);
	position: absolute;
}
#shangchuan{
	left: 80%;
	top: 270px;
	width: 10%;
	height: 24px;
	opacity: 0.67;
	border-radius: 4px;
	font-size: 14px;
	text-align: center;
	font-family: Microsoft Yahei;
	border: 1px solid ;
	position: absolute;
}
#rz_tp{
	left: 24%;
	top: 270px;
	width: 200px;
	height: 120px;
	opacity: 0.67;
	border-radius: 4px;
	text-align: center;
	font-family: Microsoft Yahei;
	border: 1px solid rgba(187, 187, 187, 1);
	position: absolute;
}
</style>
</head>
<body>
	<div class="jiemian">
		<div class="top"></div>
		<div class="head">
			<img class="fanhui" src="images/btn_fanhui@3x.png"><p class="biaoti">个人认证</p>
		</div>
		<div>
			<div>
			<div>
				<input id="id_card" type="text" name="id_card" value="" placeholder="身份证">
			</div>
			<div>
				<input id="verify_text" type="text" name="" value="" placeholder="姓名">
			</div>
			<div>
				<input id="xukezheng" type="text" name="xukezheng" value="" placeholder="许可证">
			</div>
			<div>
				<input id="rz_iphone" type="text" name="rz_iphone" value="" placeholder="电话">
			</div>
			<div>
				<img id="rz_tp" src="">
				<input id="tp_shangchuan" type="file" name="tp_shangchuan" value="" value="上传许可证照片" multiple="multiple"> 
			</div>
		<div id="rz">
			<input id="renzheng" type="submit" name="wancheng" value="认证">
		</div>
	</div>

	<!--请在下方写此页面业务相关的脚本-->
	<script type="text/javascript" src="js/jquery-3.3.1.min.js"></script>
	<script type="text/javascript" src="js/require.js"></script>
	<script type="text/javascript">
		var token = sessionStorage.getItem("token");
		$.ajax({
			url: url + 'm/certify', 
			type: "get",
			processData: false,
			contentType: false,
			beforeSend: function (XMLHttpRequest) {  
				XMLHttpRequest.setRequestHeader("ww-token", token);  
			},  
			success: function (res) {
				var id_card=res.data['id_card'];
				var trade_license=res.data['trade_license'];
				var trade_license_img=res.data['trade_license_img'];
				var realname=res.data['realname'];
				var certify_phone=res.data['certify_phone'];
				var certify_status=res.data['certify_status'];
				$('#id_card').val(id_card);
				$('#verify_text').val(realname);
				$('#xukezheng').val(trade_license);
				$('#rz_iphone').val(certify_phone);
				$('#rz_tp').attr('src',url+trade_license_img);
				if (certify_status==1) {
					alert("认证中");
				}else if (certify_status==2) {
					alert("认证失败,请修改");
				}else{
					$('#rz').css('display','none'); 
				}
			},
			error: function (err) {
				alert(JSON.stringify(err));
				}
		});
	</script>
	<script> 
		$(".fanhui").click(function(){
	    		location.href='gerenzhongxin.html';
		 });
		$("#renzheng").click(function(){
			var formData = new FormData();
			formData.append('image[]', $('#tp_shangchuan')[0].files[0]);
		 	var id_card = $("#id_card").val();
			var realname = $("#verify_text").val();
			var trade_license = $("#xukezheng").val();
			var certify_phone = $("#rz_iphone").val();
			var trade_license_img = $("#tp_shangchuan").val();
			if(id_card.length*realname.length*trade_license.length*certify_phone.length*trade_license_img.length===0){
				 alert("您还没有输入");
			}			
			var token = sessionStorage.getItem("token");

			if(!isNaN(token)){ 
					window.location.href ='login.html';
				}else{
					$.ajax({
				        url: url + 'm/setCertifyImage', 
				        type: "post",
				        data: formData, 
				        processData: false,
				        contentType: false,
				        beforeSend: function (XMLHttpRequest) {  
				                XMLHttpRequest.setRequestHeader("ww-token", token);  
				        },  
				        success: function (res) {  
									if(res.code == 200){ 
										var path=res.data['trade_license_img'];
										ajax_method("m/certify","post",{id_card: id_card,trade_license:trade_license,trade_license_img: path,certify_phone:certify_phone,realname:realname},token,function (res) {
								           			if(res.code == 200){ 
									            		 alert('上传成功');
													}else{
														 alert(res.msg);
													} 
							            });  
											
									}else{
										alert(res.msg);
									}
				        },
				        error: function (err) {
				            alert(JSON.stringify(err));
				        }
				      });
				 
				}
		});
	</script>
</body>
</html>