<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
	<meta name="viewport" content="width=device-width,initial-scale=1" />
	<title>修改信息</title>
	<link rel="stylesheet" type="text/css" href="css/common.css">
	<script type="text/javascript" src="js/jquery-3.3.1.min.js"></script>
	<script type="text/javascript" src="js/require.js"></script>
	<script type="text/javascript">
		var token = sessionStorage.getItem("token");
		$.ajax({
			url: url + 'm/getUserInfo', 
			type: "get",
			processData: false,
			contentType: false,
			beforeSend: function (XMLHttpRequest) {  
				XMLHttpRequest.setRequestHeader("ww-token", token);  
			},  
			success: function (res) {
				var head_img=res.data['head_img'];
				var nickname=res.data['nickname'];
				var phone=res.data['phone'];
				var sex=res.data['sex'];
				$('#xg_nicheng').val(nickname);
				$("#xg_touxiang").attr('src',head_img); 
				$("#xg_xingbie option:selected").text(sex);
				if (sex==="男") {
					$("#xg_xingbie").find("option[text='男']").attr("selected",true);
				}else if (sex==="女") {
					$("#xg_xingbie").find("option[text='女']").attr("selected",true);
				}else{
					$("#xg_xingbie").find("option[text='保密']").attr("selected",true);
				}
			},
			error: function (err) {
				alert(JSON.stringify(err));
				}
		});
	</script>
<style type="text/css">
#touxiang{
	left: 30%;
	top: 89px;
	width: 170px;
	height: 170px;
	line-height: 20px;
	border-radius: 100px;
	text-align: center;
	box-shadow: 0px 0px 42px 0px;
	border: 1px solid;
	-moz-border-radius: 50%;   
	-webkit-border-radius: 50%;
	background-color: rgba(63, 81, 181, 1);
	float: left;
	position: absolute;
}
#xg_touxiang{
	left: 0px;
	width: 170px;
	height: 170px;
	float: left;
	position: absolute;
}
#zhuanfa{
	right:12px;
	top: 25px;
	width: 15px;
	height: 15px;
	float: left;
	position: absolute;
}
#xz_wenjian{
	left: 35%;
	top: 100px;
	width: 70px;
	height: 70px;
	float: left;
	position: absolute;
}
#shangchuan{
	left: 42%;
	top: 365px;
	width: 70px;
	height: 23px;
	float: left;
	position: absolute;
}
#xz_wenjian{
	left: 0px;
	width: 160px;
	height: 160px;
	float: left;
	position: absolute;
    opacity:0;
    filter:alpha(opacity=0);
    position: absolute;
    top: 0;
    left: 0;
    z-index: 9;
}
#xg_nicheng{
	float: left;
	left: 10%;
	top: 273px; 
	height: 26px; 
	line-height:30px;
	width: 80%;
	text-align: left;
	border: 1px solid rgba(187, 187, 187, 1);
	position: absolute;
}
#xg_xingbie{
	float: left;
	left: 10%;
	top: 320px; 
	height: 26px; 
	line-height:30px;
	width: 80%;
	text-align: left;
	border: 1px solid rgba(187, 187, 187, 1);
	position: absolute;
}
</style>
</head>
<body>
	<div class="jiemian">
		<div class="top"></div>
		<div class="head">
			<img class="fanhui" src="images/btn_fanhui@3x.png"><p class="biaoti">修改信息</p><span id="zhuanfa" name="zhuanfa">...</span>
		</div>
		<div id="touxiang">
			<img id="xg_touxiang" src="images/touxiang@3x.png">
			<input id="xz_wenjian" type="file" name="xz_wenjian">
		</div>
		<div>
			<input id="xg_nicheng" type="text" name="nicheng" value="">
		</div>
		<div>
			
				<select id="xg_xingbie">
				  	<option value ="1">男</option>
				  	<option value ="2">女</option>
				  	<option value="0">保密</option>
				</select>
		</div>
		<div>
			<input id="shangchuan" type="button" value="上传">
		</div>
	</div>
	

	<script type="text/javascript">  
		$(".fanhui").click(function(){
    		location.href='gerenzhongxin.html';
		 });
		$("#shangchuan").click(function(){
			var formData = new FormData();
			formData.append('image[]', $('#xz_wenjian')[0].files[0]);
			var token = sessionStorage.getItem("token");
			if(!isNaN(token)){ 
					window.location.href ='login.html';
				}else{
					$.ajax({
						url: url + 'm/setHeadImage', 
						type: "post",
						data: formData, 
						processData: false,
						contentType: false,
						beforeSend: function (XMLHttpRequest) {  
							XMLHttpRequest.setRequestHeader("ww-token", token);  
						},  
						success: function (res) {
							if(res.code == 200){
								var img_url=res.data['head_img'];
								var nickname=$('#xg_nicheng').val();
								var sex=$("#xg_xingbie option:selected").val();
								ajax_method("m/setUserInfo","post",{nickname: nickname,img_url:img_url,sex: sex},token,function (res) {
									if(res.code == 200){ 
										alert('修改成功');
									}else{
										alert(res.msg);
									} 
								});
							}else{
								alert(res.msg);
							}
						},
						error: function (err) {
							alert(JSON.stringify(err));
						}
					});
				 
				}
		});
	</script>
</body>
</html>